/*! \file */
/******************************************************************************
 * Final Project: Guitar Hero
 *
 * Description: A guitar hero game.
 * Authors: Josh Schrock and Lisa Sebastian
 * Last-modified: 2/6/2023
 *
 *
*******************************************************************************/
#include "msp.h"

/* Standard Includes */
#include <stdint.h>
#include <stdbool.h>
#include <stdio.h>
#include "csHFXT.h"
#include "csLFXT.h"
#include "pushButtons.h"
#include "guitarButtons.h"
#include "lcd.h"
#include "i2c_ops.h"
#include "oled.h"
#include "oled_ops.h"

unsigned char clr_data[1024] = {0};
unsigned char TEXT_ARR[1024];
unsigned char LOGO_ARR[1024];

//clock define
#define CLK_FREQUENCY       48000000    // MCLK using 48MHz HFXT

/* note defines */
#define NOTENONE 90.55
#define NOTEE3 164.81
#define NOTEF3 174.61
#define NOTEF3SHARP 185.00
#define NOTEG3 196.00
#define NOTEG3SHARP 207.65
#define NOTEA3 220.00
#define NOTEA3SHARP 233.08
#define NOTEB3 246.94
#define NOTEC4 261.63
#define NOTEC4SHARP 277.18
#define NOTED4 293.66
#define NOTED4SHARP 311.13
#define NOTEE4 329.63
#define NOTEF4 349.23
#define NOTEF4SHARP 369.99
#define NOTEG4 392.00
#define NOTEG4SHARP 415.30
#define NOTEA4 440.00
#define NOTEA4SHARP 466.16
#define NOTEB4 493.88
#define NOTEC5 523.25
#define NOTEC5SHARP 554.37
#define NOTED5 587.33

/* length defines */
#define NOTEREST 1000
#define SIXTEENNOTE 3096
#define EIGHTNOTE 7192
#define SIXTIENOTE 11288
#define QUARTERNOTE 15384
#define TIENOTE 23576
#define HALFNOTE 31768
#define WHOLENOTE 64536

// guitar button defines
#define SINGLENOTETIME 6000

//define game
#define INITHEALTH     9

typedef enum _GuitarButtons {
    BNONE,       /* (0x0) */
    BONE,        /* (0x1) */
    BTWO,        /* (0x2) */
    BTHREE,      /* (0x3) */
    BFOUR        /* (0x4) */
} GuitarButtons;

/* song defines */
#define NOTECNT 90
const uint16_t noteArray[NOTECNT] =   {NOTEG4,      NOTENONE,  NOTED4,    NOTEG4,      NOTENONE,  NOTED4,      NOTEG4,    NOTED4,    NOTEG4,    NOTEB4,    NOTED5,      NOTENONE,  NOTEC5,      NOTENONE,  NOTEA4,    NOTEC5,      NOTENONE,  NOTEA4,    NOTEC5,    NOTEA4,    NOTEF4SHARP, NOTEA4,    NOTED4,      NOTENONE,    NOTEG4,    NOTENONE,  NOTEG4,  NOTEB4,    NOTEA4,    NOTEG4,    NOTEG4,    NOTEF4SHARP, NOTEF4SHARP, NOTEG4,    NOTEC5,    NOTEF4SHARP, NOTEA4,    NOTEG4,    NOTEG4,  NOTEB4,    NOTEA4,    NOTEG4,    NOTEG4,    NOTEF4SHARP, NOTEF4SHARP, NOTEA4,    NOTEC5,    NOTEF4SHARP, NOTEG4,    NOTEG4,    NOTEG4,    NOTEF4SHARP, NOTEE4,    NOTEF4SHARP, NOTEG4,    NOTEG4,    NOTEB4,    NOTEA4,    NOTEG4,    NOTEA4,    NOTEB4,    NOTEB4,    NOTED5,    NOTEC5,    NOTEB4,    NOTEC5,    NOTED5,      NOTENONE,    NOTED4,   NOTEE4,   NOTED4,    NOTEC4,     NOTEC4,      NOTEC4,    NOTEB3,     NOTEB3,      NOTEB3,    NOTEA3,     NOTEA3,      NOTEG3,    NOTEF3SHARP, NOTEE3,    NOTEF3SHARP, NOTEG3,    NOTENONE,  NOTEA3,    NOTENONE,  NOTEB3,    NOTENONE,  NOTENONE};
const uint16_t lengthArray[NOTECNT] = {QUARTERNOTE, EIGHTNOTE, EIGHTNOTE, QUARTERNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, QUARTERNOTE, QUARTERNOTE, QUARTERNOTE, EIGHTNOTE, EIGHTNOTE, QUARTERNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE,   EIGHTNOTE, QUARTERNOTE, QUARTERNOTE, EIGHTNOTE, EIGHTNOTE, TIENOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE,   TIENOTE,     EIGHTNOTE, EIGHTNOTE, EIGHTNOTE,   EIGHTNOTE, EIGHTNOTE, TIENOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE,   TIENOTE,     EIGHTNOTE, EIGHTNOTE, EIGHTNOTE,   EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE,   EIGHTNOTE, EIGHTNOTE,   EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, QUARTERNOTE, QUARTERNOTE, HALFNOTE, HALFNOTE, EIGHTNOTE, SIXTIENOTE, QUARTERNOTE, EIGHTNOTE, SIXTIENOTE, QUARTERNOTE, EIGHTNOTE, SIXTIENOTE, QUARTERNOTE, EIGHTNOTE, EIGHTNOTE,   EIGHTNOTE, EIGHTNOTE,   EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, EIGHTNOTE, QUARTERNOTE};
const uint16_t buttonArray[NOTECNT] = {BTWO,        BONE,      BTWO,      BTHREE,      BNONE,     BTWO,      BTWO,      BTWO,      BTWO,      BTWO,      BTHREE,      BNONE,       BONE,         BNONE,     BNONE,     BNONE,       BNONE,     BNONE,     BNONE,     BNONE,     BNONE,       BNONE,     BNONE,       BNONE,       BNONE,     BNONE,     BNONE,   BNONE,     BNONE,     BNONE,     BNONE,     BNONE,       BNONE,       BNONE,     BNONE,     BNONE,        BNONE,    BNONE,     BNONE,   BNONE,     BNONE,     BNONE,     BNONE,     BNONE,        BNONE,       BNONE ,   BNONE,      BNONE,      BNONE,     BNONE};
bool buttonExpected[4] = {false, false, false, false};
uint16_t buttonTime[4] = {0, 0, 0, 0};

/* globals */
int noteIndex = 0;
int score = 0;
int health = INITHEALTH;
bool updateLCDflag = true;
char buffer[4];

void updateLCD(int score, int health);
void gameOverLCD(int score, int health);
void startLCD(int score, int health);
void setupOLED();
void draw(int x, int y, unsigned char ascii);
void display_logos(int x, int y, unsigned char ascii_index);
void draw_line(int x ,int y,unsigned char ascii_str[16]);
void Display_Logo(int x ,int y, unsigned char logo_val);
/* Set Entire Display OFF */
void display_off();
/* Set Entire Display ON */
void display_on();
/* Clear display */
void display_clear();
void msdelay(int delay);

/**
 * main.c
 */
void main(void)
{
    volatile bool playing = false;

    /* Stop Watchdog timer */
    WDT_A->CTL = WDT_A_CTL_PW | WDT_A_CTL_HOLD;

    /* Sets MCLK and SMCLK to 48MHz HFXT */
    configHFXT();
    configLFXT();
    BUTTONS_init();
    GB_init();
    // configures pins and delay library
    configLCD(CLK_FREQUENCY);
    initLCD();

    i2c_init();
    setupOLED();
    display_on();
    display_clear();
    display_on();

    draw_line(1,1,"Line1");
    draw_line(2,1,"Line2");
    draw_line(3,1,"Line3");

    Display_Logo(1,1,0);
    Display_Logo(2,1,2);
    Display_Logo(3,1,4);

    /* Configure GPIO for speaker */
    P2->DIR |= BIT4;            // set P2.4 as output
    P2->SEL0 |= BIT4;           // P2.4 set to TA0.1
    P2->SEL1 &= ~BIT4;

    /* Configure Timer_A0 and CCRs */
    // Set Period in CCR0 register
    TIMER_A0->CCR[0] = (6005000 / (noteArray[noteIndex] + 1)) - 1;
    // Set high pulse-width in CCR1 register (determines duty cycle)
    TIMER_A0->CCR[1] = ((6005000 / (noteArray[noteIndex]) + 1) / 2) - 1;
    // Configure CCR1 for Compare mode with Set/Reset output
    //          - sets when Timer_A0 == CCR1
    //          - resets when Timer_A0 == CCR0
    TIMER_A0->CCTL[1] = 0x60;
    // Configure Timer_A0 in Up Mode with source SMCLK prescale 8:1
    //      Tick rate will be (48MHz/8) with rollover at value in CCR0

    TIMER_A0->CTL = 0x02C4;

    /* Configure Timer_A1 and CCRs */
    // Set initial period in CCR2 register. This assumes timer starts at 0
    TIMER_A1->CCR[2] = lengthArray[noteIndex];
    // Configure CCR2 for Compare mode with interrupt enabled (no output mode - 0)
    TIMER_A1->CCTL[2] = 0x0010;

    // Set initial period in CCR3 register. This assumes timer starts at 0
    TIMER_A1->CCR[3] = lengthArray[noteIndex] + NOTEREST;
    // Configure CCR3 for Compare mode with interrupt enabled (no output mode - 0)
    TIMER_A1->CCTL[3] = 0x0010;

    // Set initial period in CCR4 register. This assumes timer starts at 0
    TIMER_A1->CCR[4] = SINGLENOTETIME;
    // Configure CCR3 for Compare mode with interrupt enabled (no output mode - 0)
    TIMER_A1->CCTL[4] = 0x0010;

    // Configure Timer_A1 in Continuous Mode with source ACLK prescale 1:1 and
    //  interrupt enabled
    //      Tick rate will be 32kHz with rollover at 0xFFFF
    TIMER_A1->CTL = 0x0106;

    /* Configure global interrupts and NVIC */
    // Enable TA1 overflow and TA1CCR2 compare interrupt
    NVIC->ISER[0] |= 1 << TA1_N_IRQn;


    __enable_irq();                 // Enable global interrupt

    while(1)
    {
        if(BUTTON2_pressed()) {
            if(playing){
                TIMER_A0->CTL &= ~0x0010;
                TIMER_A1->CTL &= ~0x0020;
                BUTTON2_debounce();
                playing = false;
            }else{
                BUTTON2_debounce();
                TIMER_A0->CTL |= 0x0010;
                TIMER_A1->CTL |= 0x0020;
                playing = true;
                startLCD(score, health);
            }
        }
        // what to do if playing
        if (playing) {
            if (GB1_pressed()) {
                if(buttonExpected[0]) {
                    buttonExpected[0] = false;
                    score++;
                } else {
                    health--;
                }
                updateLCDflag = true;
                GB1_debounce();
            }
            if (GB2_pressed()) {
                if(buttonExpected[1]) {
                    buttonExpected[1] = false;
                    score++;
                } else {
                    health--;
                }
                updateLCDflag = true;
                GB2_debounce();
            }
            if (GB3_pressed()) {
                if (buttonExpected[2]) {
                    buttonExpected[2] = false;
                    score++;
                } else {
                    health--;
                }
                updateLCDflag = true;
                GB3_debounce();
            }
            if (GB4_pressed()) {
                if (buttonExpected[3]) {
                    buttonExpected[3] = false;
                    score++;
                } else {
                    health--;
                }
                updateLCDflag = true;
                GB4_debounce();
            }
            if (updateLCDflag) {
                updateLCD(score, health);
            }
            if (health <= 0) {
                gameOverLCD(score, health);
                TIMER_A0->CTL &= ~0x0010;
                TIMER_A1->CTL &= ~0x0020;
                playing = false;

                health = INITHEALTH;
                score = 0;

                noteIndex = 0;
                // Set Period in CCR0 register
                TIMER_A0->CCR[0] = (6005000 / (noteArray[noteIndex] + 1)) - 1;
                // Set high pulse-width in CCR1 register (determines duty cycle)
                TIMER_A0->CCR[1] = ((6005000 / (noteArray[noteIndex]) + 1) / 2) - 1;
                // Set initial period in CCR2 register. This assumes timer starts at 0
                TIMER_A1->CCR[2] = lengthArray[noteIndex];
                // Set initial period in CCR3 register. This assumes timer starts at 0
                TIMER_A1->CCR[3] = lengthArray[noteIndex] + NOTEREST;
                // Set initial period in CCR4 register. This assumes timer starts at 0
                TIMER_A1->CCR[4] = SINGLENOTETIME;
            }
        }
        write_display(TEXT_ARR);
        msdelay(500);
        write_display(LOGO_ARR);
        msdelay(500);
    }
}
void gameOverLCD(int score, int health) {
    clearDisplay();
    int i;

    printChar('G');
    printChar('A');
    printChar('M');
    printChar('E');
    printChar(' ');
    printChar('O');
    printChar('V');
    printChar('E');
    printChar('R');
    commandInstruction(SET_CURSOR_MASK | 0x40);
    snprintf(buffer, 4, "%d     ", score);
    printChar('S');
    printChar('c');
    printChar('o');
    printChar('r');
    printChar('e');
    printChar(':');
    printChar(' ');
    for (i = 0; i < 3; i++) {
        printChar(buffer[i]);
    }
    updateLCDflag = false;
}

void updateLCD(int score, int health) {
    commandInstruction(SET_CURSOR_MASK | 0x07);

    int i;
    snprintf(buffer, 4, "%d     ", score);
    for (i = 0; i < 3; i++) {
        printChar(buffer[i]);
    }

    commandInstruction(SET_CURSOR_MASK | 0x48);
    snprintf(buffer, 4, "%d     ", health);
    for (i = 0; i < 3; i++) {
        printChar(buffer[i]);
    }

    updateLCDflag = false;
}

void startLCD(int score, int health) {
    clearDisplay();
    int i;
    snprintf(buffer, 4, "%d     ", score);
    printChar('S');
    printChar('c');
    printChar('o');
    printChar('r');
    printChar('e');
    printChar(':');
    printChar(' ');
    for (i = 0; i < 3; i++) {
        printChar(buffer[i]);
    }

    commandInstruction(SET_CURSOR_MASK | 0x40);
    snprintf(buffer, 4, "%d     ", health);
    printChar('H');
    printChar('e');
    printChar('a');
    printChar('l');
    printChar('t');
    printChar('h');
    printChar(':');
    printChar(' ');
    for (i = 0; i < 3; i++) {
        printChar(buffer[i]);
    }

    updateLCDflag = false;
}

/* Timer_A1 and CCRx (except CCR0) interrupt service routine */
void TA1_N_IRQHandler(void)
{
    /* Check if interrupt triggered by timer overflow */
    if(TIMER_A1->CTL & TIMER_A_CTL_IFG)
    {
        // Clear timer overflow flag
        // clear flag in TA1CTL
        TIMER_A1->CTL = TIMER_A1->CTL & 0xFFFE;
    }

    /* Check if interrupt triggered by CCR2 */
    if(TIMER_A1->CCTL[2] & TIMER_A_CCTLN_CCIFG)
    {
        /* add note changing code (update compare registers) */
        TIMER_A0->CTL &= ~0x0010;
        TIMER_A0->CCTL[1] &= ~0x0004;

        // Clear CCR2 compare interrupt flag
        // clear flag in TA1CCTL2
        TIMER_A1->CCTL[2] = TIMER_A1->CCTL[2] & 0xFFFE;
    }

    /* Check if interrupt triggered by CCR3 */
    if(TIMER_A1->CCTL[3] & TIMER_A_CCTLN_CCIFG)
    {
        noteIndex = (noteIndex + 1) % NOTECNT;
        /* add note changing code (update compare registers) */
        TIMER_A0->CTL |= 0x0010;
        TIMER_A0->CCR[0] = (6005000 / (noteArray[noteIndex] + 1)) - 1;
        TIMER_A0->CCR[1] = ((6005000 / (noteArray[noteIndex]) + 1) / 2) - 1;

        // Update Buttons

        if(buttonArray[noteIndex] != BNONE) {
            buttonExpected[buttonArray[noteIndex] - 1] = true;
            buttonTime[buttonArray[noteIndex] - 1] = SINGLENOTETIME;
            TIMER_A1->CCR[4] = TIMER_A1->CCR[3] + SINGLENOTETIME;
            //Enable timer interrupt
            TIMER_A1->CCTL[4] = 0x0010;
        }


        // Clear CCR2 compare interrupt flag
        // clear flag in TA1CCTL2
        TIMER_A1->CCTL[3] = TIMER_A1->CCTL[3] & 0xFFFE;

        // Schedule next interrupt interval
        TIMER_A1->CCR[2] = (TIMER_A1->CCR[3] + lengthArray[noteIndex]) % 0xFFFF;
        TIMER_A1->CCR[3] = (TIMER_A1->CCR[3] + lengthArray[noteIndex] + NOTEREST) % 0xFFFF;

    }

    /* Check if interrupt triggered by CCR4 */
    if(TIMER_A1->CCTL[4] & TIMER_A_CCTLN_CCIFG)
    {
        // Update Buttons
        int i;
        for (i=0; i < 4; i++) {
            if (buttonExpected[i]) {
                health--;
                buttonExpected[i] = false;
                updateLCDflag = true;
            }
        }

        // Clear CCR4 compare interrupt flag and turn off interrupt
        TIMER_A1->CCTL[4] = 0x0000;

    }
}
void setupOLED()
{
    // init SSD1306 settings
    sendCommand(SSD1306_DISPLAYOFF);  // Display off
    sendCommand(SSD1306_MULTIPLEX_RATIO);  // Set Multiplex Ratio
    sendCommand(0x3F);

    sendCommand(0xD3);  // Set Display Offset
    sendCommand(0x00);  // no Offset

    sendCommand(0x40);  // Set display Start Line
    sendCommand(0xA1);  // Set Segment Re-Map
    sendCommand(0xC8);  // Set COM Output Scan Direction

    sendCommand(0xA6);
    sendCommand(0xD5);
    sendCommand(0x80);

    sendCommand(0xDA);  // Set COM Pins Hardware Configuration
    sendCommand(0x12);

    sendCommand(0x81);  // Set Contrast Control
    sendCommand(0x7F);

    sendCommand(0xA4);  // Set Entire Display On/Off

    sendCommand(0xA6);  // Set Normal/Inverse Display

    sendCommand(0xD9);  // Set Pre-Charge Period
    sendCommand(0xF1);  // Snternal

    sendCommand(0xDB);  // Set VCOMH Deselect Level
    sendCommand(0x40);

    sendCommand(0xD5);  // Set Display Clock Divide Ratio\Oscilator Frequency
    sendCommand(0x80);  // the suggested ratio 0x80

    sendCommand(0x8D);  // Set Charge Pump

    sendCommand(0x14);  // Vcc internal

    sendCommand(0x00);  // Set Lower Column Start Address

    sendCommand(0x10);  // Set Higher Column Start Address

    sendCommand(0xB0);  // Set Page Start Address for Page Addressing Mode

    // 00 - Horizontal Addressing Mode
    // 01 - Vertical Addressing Mode
    // 02 - Page Addressing Mode
    sendCommand(0x20);  // Set Memory Addressing Mode
    sendCommand(0x00);

    sendCommand(0x21);  // Set Column Address (only for horizontal or vertical mode)
    sendCommand(0x00);
    sendCommand(0x7F);

    sendCommand(0x22);  // Set Page Address
    sendCommand(0x00);
    sendCommand(0x07);

    sendCommand(0x2E);  // Deactivate Scroll
}

//unsigned char a[]={0x00,0x00,0xC0,0x38,0xE0,0x00,0x00,0x00,0x20,0x3C,0x23,0x02,0x02,0x27,0x38,0x20};

void draw(int x, int y, unsigned char ascii){
    unsigned char a[8], b[8];  // init two array with one byte
    unsigned int ascii_index;
    unsigned char num_str[95][16] = {
        {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},//  0
        {0x00,0x00,0x00,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x33,0x30,0x00,0x00,0x00},//! 1
        {0x00,0x10,0x0C,0x06,0x10,0x0C,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},//" 2
        {0x40,0xC0,0x78,0x40,0xC0,0x78,0x40,0x00,0x04,0x3F,0x04,0x04,0x3F,0x04,0x04,0x00},//# 3
        {0x00,0x70,0x88,0xFC,0x08,0x30,0x00,0x00,0x00,0x18,0x20,0xFF,0x21,0x1E,0x00,0x00},//$ 4
        {0xF0,0x08,0xF0,0x00,0xE0,0x18,0x00,0x00,0x00,0x21,0x1C,0x03,0x1E,0x21,0x1E,0x00},//% 5
        {0x00,0xF0,0x08,0x88,0x70,0x00,0x00,0x00,0x1E,0x21,0x23,0x24,0x19,0x27,0x21,0x10},//& 6
        {0x10,0x16,0x0E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},//' 7
        {0x00,0x00,0x00,0xE0,0x18,0x04,0x02,0x00,0x00,0x00,0x00,0x07,0x18,0x20,0x40,0x00},//( 8
        {0x00,0x02,0x04,0x18,0xE0,0x00,0x00,0x00,0x00,0x40,0x20,0x18,0x07,0x00,0x00,0x00},//) 9
        {0x40,0x40,0x80,0xF0,0x80,0x40,0x40,0x00,0x02,0x02,0x01,0x0F,0x01,0x02,0x02,0x00},//'*' 10
        {0x00,0x00,0x00,0xF0,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x1F,0x01,0x01,0x01,0x00},//+ 11
        {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xB0,0x70,0x00,0x00,0x00,0x00,0x00},//, 12
        {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01},//- 13
        {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,0x00,0x00},//. 14
        {0x00,0x00,0x00,0x00,0x80,0x60,0x18,0x04,0x00,0x60,0x18,0x06,0x01,0x00,0x00,0x00},/// 15
        {0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x0F,0x10,0x20,0x20,0x10,0x0F,0x00},//0 16
        {0x00,0x10,0x10,0xF8,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00},//1 17
        {0x00,0x70,0x08,0x08,0x08,0x88,0x70,0x00,0x00,0x30,0x28,0x24,0x22,0x21,0x30,0x00},//2 18
        {0x00,0x30,0x08,0x88,0x88,0x48,0x30,0x00,0x00,0x18,0x20,0x20,0x20,0x11,0x0E,0x00},//3 19
        {0x00,0x00,0xC0,0x20,0x10,0xF8,0x00,0x00,0x00,0x07,0x04,0x24,0x24,0x3F,0x24,0x00},//4 20
        {0x00,0xF8,0x08,0x88,0x88,0x08,0x08,0x00,0x00,0x19,0x21,0x20,0x20,0x11,0x0E,0x00},//5 21
        {0x00,0xE0,0x10,0x88,0x88,0x18,0x00,0x00,0x00,0x0F,0x11,0x20,0x20,0x11,0x0E,0x00},//6 22
        {0x00,0x38,0x08,0x08,0xC8,0x38,0x08,0x00,0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00},//7 23
        {0x00,0x70,0x88,0x08,0x08,0x88,0x70,0x00,0x00,0x1C,0x22,0x21,0x21,0x22,0x1C,0x00},//8 24
        {0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x00,0x31,0x22,0x22,0x11,0x0F,0x00},//9 25
        {0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00},//: 26
        {0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x60,0x00,0x00,0x00,0x00},//; 27
        {0x00,0x00,0x80,0x40,0x20,0x10,0x08,0x00,0x00,0x01,0x02,0x04,0x08,0x10,0x20,0x00},//< 28
        {0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x00,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x00},//= 29
        {0x00,0x08,0x10,0x20,0x40,0x80,0x00,0x00,0x00,0x20,0x10,0x08,0x04,0x02,0x01,0x00},//> 30
        {0x00,0x70,0x48,0x08,0x08,0x08,0xF0,0x00,0x00,0x00,0x00,0x30,0x36,0x01,0x00,0x00},//? 31
        {0xC0,0x30,0xC8,0x28,0xE8,0x10,0xE0,0x00,0x07,0x18,0x27,0x24,0x23,0x14,0x0B,0x00},//@ 32
        {0x00,0x00,0xC0,0x38,0xE0,0x00,0x00,0x00,0x20,0x3C,0x23,0x02,0x02,0x27,0x38,0x20},//A 33
        {0x08,0xF8,0x88,0x88,0x88,0x70,0x00,0x00,0x20,0x3F,0x20,0x20,0x20,0x11,0x0E,0x00},//B 34
        {0xC0,0x30,0x08,0x08,0x08,0x08,0x38,0x00,0x07,0x18,0x20,0x20,0x20,0x10,0x08,0x00},//C 35
        {0x08,0xF8,0x08,0x08,0x08,0x10,0xE0,0x00,0x20,0x3F,0x20,0x20,0x20,0x10,0x0F,0x00},//D 36
        {0x08,0xF8,0x88,0x88,0xE8,0x08,0x10,0x00,0x20,0x3F,0x20,0x20,0x23,0x20,0x18,0x00},//E 37
        {0x08,0xF8,0x88,0x88,0xE8,0x08,0x10,0x00,0x20,0x3F,0x20,0x00,0x03,0x00,0x00,0x00},//F 38
        {0xC0,0x30,0x08,0x08,0x08,0x38,0x00,0x00,0x07,0x18,0x20,0x20,0x22,0x1E,0x02,0x00},//G 39
        {0x08,0xF8,0x08,0x00,0x00,0x08,0xF8,0x08,0x20,0x3F,0x21,0x01,0x01,0x21,0x3F,0x20},//H 40
        {0x00,0x08,0x08,0xF8,0x08,0x08,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00},//I 41
        {0x00,0x00,0x08,0x08,0xF8,0x08,0x08,0x00,0xC0,0x80,0x80,0x80,0x7F,0x00,0x00,0x00},//J 42
        {0x08,0xF8,0x88,0xC0,0x28,0x18,0x08,0x00,0x20,0x3F,0x20,0x01,0x26,0x38,0x20,0x00},//K 43
        {0x08,0xF8,0x08,0x00,0x00,0x00,0x00,0x00,0x20,0x3F,0x20,0x20,0x20,0x20,0x30,0x00},//L 44
        {0x08,0xF8,0xF8,0x00,0xF8,0xF8,0x08,0x00,0x20,0x3F,0x00,0x3F,0x00,0x3F,0x20,0x00},//M 45
        {0x08,0xF8,0x30,0xC0,0x00,0x08,0xF8,0x08,0x20,0x3F,0x20,0x00,0x07,0x18,0x3F,0x00},//N 46
        {0xE0,0x10,0x08,0x08,0x08,0x10,0xE0,0x00,0x0F,0x10,0x20,0x20,0x20,0x10,0x0F,0x00},//O 47
        {0x08,0xF8,0x08,0x08,0x08,0x08,0xF0,0x00,0x20,0x3F,0x21,0x01,0x01,0x01,0x00,0x00},//P 48
        {0xE0,0x10,0x08,0x08,0x08,0x10,0xE0,0x00,0x0F,0x18,0x24,0x24,0x38,0x50,0x4F,0x00},//Q 49
        {0x08,0xF8,0x88,0x88,0x88,0x88,0x70,0x00,0x20,0x3F,0x20,0x00,0x03,0x0C,0x30,0x20},//R 50
        {0x00,0x70,0x88,0x08,0x08,0x08,0x38,0x00,0x00,0x38,0x20,0x21,0x21,0x22,0x1C,0x00},//S 51
        {0x18,0x08,0x08,0xF8,0x08,0x08,0x18,0x00,0x00,0x00,0x20,0x3F,0x20,0x00,0x00,0x00},//T 52
        {0x08,0xF8,0x08,0x00,0x00,0x08,0xF8,0x08,0x00,0x1F,0x20,0x20,0x20,0x20,0x1F,0x00},//U 53
        {0x08,0x78,0x88,0x00,0x00,0xC8,0x38,0x08,0x00,0x00,0x07,0x38,0x0E,0x01,0x00,0x00},//V 54
        {0xF8,0x08,0x00,0xF8,0x00,0x08,0xF8,0x00,0x03,0x3C,0x07,0x00,0x07,0x3C,0x03,0x00},//W 55
        {0x08,0x18,0x68,0x80,0x80,0x68,0x18,0x08,0x20,0x30,0x2C,0x03,0x03,0x2C,0x30,0x20},//X 56
        {0x08,0x38,0xC8,0x00,0xC8,0x38,0x08,0x00,0x00,0x00,0x20,0x3F,0x20,0x00,0x00,0x00},//Y 57
        {0x10,0x08,0x08,0x08,0xC8,0x38,0x08,0x00,0x20,0x38,0x26,0x21,0x20,0x20,0x18,0x00},//Z 58
        {0x00,0x00,0x00,0xFE,0x02,0x02,0x02,0x00,0x00,0x00,0x00,0x7F,0x40,0x40,0x40,0x00},//[ 59
        {0x00,0x0C,0x30,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x06,0x38,0xC0,0x00},//\ 60
        {0x00,0x02,0x02,0x02,0xFE,0x00,0x00,0x00,0x00,0x40,0x40,0x40,0x7F,0x00,0x00,0x00},//] 61
        {0x00,0x00,0x04,0x02,0x02,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},//^ 62
        {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80},//_ 63
        {0x00,0x02,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},//` 64
        {0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x19,0x24,0x22,0x22,0x22,0x3F,0x20},//a 65
        {0x08,0xF8,0x00,0x80,0x80,0x00,0x00,0x00,0x00,0x3F,0x11,0x20,0x20,0x11,0x0E,0x00},//b 66
        {0x00,0x00,0x00,0x80,0x80,0x80,0x00,0x00,0x00,0x0E,0x11,0x20,0x20,0x20,0x11,0x00},//c 67
        {0x00,0x00,0x00,0x80,0x80,0x88,0xF8,0x00,0x00,0x0E,0x11,0x20,0x20,0x10,0x3F,0x20},//d 68
        {0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x1F,0x22,0x22,0x22,0x22,0x13,0x00},//e 69
        {0x00,0x80,0x80,0xF0,0x88,0x88,0x88,0x18,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00},//f 70
        {0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x6B,0x94,0x94,0x94,0x93,0x60,0x00},//g 71
        {0x08,0xF8,0x00,0x80,0x80,0x80,0x00,0x00,0x20,0x3F,0x21,0x00,0x00,0x20,0x3F,0x20},//h 72
        {0x00,0x80,0x98,0x98,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00},//i 73
        {0x00,0x00,0x00,0x80,0x98,0x98,0x00,0x00,0x00,0xC0,0x80,0x80,0x80,0x7F,0x00,0x00},//j 74
        {0x08,0xF8,0x00,0x00,0x80,0x80,0x80,0x00,0x20,0x3F,0x24,0x02,0x2D,0x30,0x20,0x00},//k 75
        {0x00,0x08,0x08,0xF8,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00},//l 76
        {0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x20,0x3F,0x20,0x00,0x3F,0x20,0x00,0x3F},//m 77
        {0x80,0x80,0x00,0x80,0x80,0x80,0x00,0x00,0x20,0x3F,0x21,0x00,0x00,0x20,0x3F,0x20},//n 78
        {0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x1F,0x20,0x20,0x20,0x20,0x1F,0x00},//o 79
        {0x80,0x80,0x00,0x80,0x80,0x00,0x00,0x00,0x80,0xFF,0xA1,0x20,0x20,0x11,0x0E,0x00},//p 80
        {0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x0E,0x11,0x20,0x20,0xA0,0xFF,0x80},//q 81
        {0x80,0x80,0x80,0x00,0x80,0x80,0x80,0x00,0x20,0x20,0x3F,0x21,0x20,0x00,0x01,0x00},//r 82
        {0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x33,0x24,0x24,0x24,0x24,0x19,0x00},//s 83
        {0x00,0x80,0x80,0xE0,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x1F,0x20,0x20,0x00,0x00},//t 84
        {0x80,0x80,0x00,0x00,0x00,0x80,0x80,0x00,0x00,0x1F,0x20,0x20,0x20,0x10,0x3F,0x20},//u 85
        {0x80,0x80,0x80,0x00,0x00,0x80,0x80,0x80,0x00,0x01,0x0E,0x30,0x08,0x06,0x01,0x00},//v 86
        {0x80,0x80,0x00,0x80,0x00,0x80,0x80,0x80,0x0F,0x30,0x0C,0x03,0x0C,0x30,0x0F,0x00},//w 87
        {0x00,0x80,0x80,0x00,0x80,0x80,0x80,0x00,0x00,0x20,0x31,0x2E,0x0E,0x31,0x20,0x00},//x 88
        {0x80,0x80,0x80,0x00,0x00,0x80,0x80,0x80,0x80,0x81,0x8E,0x70,0x18,0x06,0x01,0x00},//y 89
        {0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x21,0x30,0x2C,0x22,0x21,0x30,0x00},//z 90
        {0x00,0x00,0x00,0x00,0x80,0x7C,0x02,0x02,0x00,0x00,0x00,0x00,0x00,0x3F,0x40,0x40},//{ 91
        {0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00},//| 92
        {0x00,0x02,0x02,0x7C,0x80,0x00,0x00,0x00,0x00,0x40,0x40,0x3F,0x00,0x00,0x00,0x00},//} 93
        {0x00,0x06,0x01,0x01,0x02,0x02,0x04,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},//~ 94
    };

    ascii_index = (ascii - 32);  // correct ascii offset
    memcpy(a, num_str[ascii_index], 8);
    memcpy(b, num_str[ascii_index] + 8, 8);
    memcpy(TEXT_ARR + ((x - 1) * 256) + ((y - 1) * 8), a, 8);
    memcpy(TEXT_ARR + ((x - 1) * 256) + ((y - 1) * 8) + 128, b, 8);
}

/************************logo_array****************************/
void display_logos(int x, int y, unsigned char ascii_index)
{
    unsigned char a[8], b[8],c[8];  // init two array with one byte
    //unsigned int ascii_index;
    int i,j,k,l;
    unsigned char num_str[95][16] = {

    //warninig
            {0x00,0x00,0x00,0xc0,0xf0,0xfc,0xfe,0x07,0xe0,0xfc,0xff,0xff,0xff,0xff,0xff,0xe6}, //index 0
            {0x07,0xfe,0xfc,0xf0,0xc0,0x80,0x00,0x00,0xe6,0xff,0xff,0xff,0xff,0xff,0xfc,0xe0}, //index 1
    //alaram
            {0x00,0x00,0x00,0x00,0xf8,0xfc,0xfe,0xff,0x08,0x0c,0x0e,0x0f,0x0f,0x0f,0x0f,0x6f}, //index 2
            {0xff,0xff,0xfe,0xfc,0xf8,0x00,0x00,0x00,0xef,0x6f,0x0f,0x0f,0x0f,0x0e,0x0c,0x08}, //index 3
    //alaram_sound
            {0x78,0x84,0x32,0x4a,0x00,0xfc,0xfe,0xfe,0x00,0x10,0x19,0x1d,0x1e,0x1f,0x5f,0xdf}, //index 4
            {0xfe,0xfe,0xfc,0x00,0x4a,0x32,0x84,0x78,0xdf,0x5f,0x1f,0x1e,0x1d,0x19,0x10,0x00}, //index 5
    //alaram snooz
            {0xe0,0xf8,0x0c,0x06,0x20,0x60,0xc0,0x82,0x07,0x1f,0x30,0x60,0x40,0x80,0x80,0x83}, //index 6
            {0x87,0x83,0x00,0x03,0x06,0x0c,0xf8,0xe0,0x83,0x83,0x80,0x40,0x60,0x30,0x1f,0x07}, //index 7
    //alaram silent
            {0x0c,0x18,0x30,0x70,0xf8,0xfc,0xfe,0xfe,0x00,0x08,0x0c,0x0e,0x0e,0x09,0x4b,0xc7}, //index 8
            {0xfe,0xfe,0xfc,0xf8,0x00,0x00,0x00,0x00,0xcf,0x5f,0x3f,0x7f,0xce,0x8c,0x08,0x00}, //index 9
    //bluetooth
            {0x00,0x08,0x18,0x30,0x60,0xc0,0x80,0xff,0x00,0x40,0x60,0x30,0x18,0x0c,0x07,0xff}, //index 10
            {0xff,0x06,0x8c,0xd8,0x70,0x20,0x00,0x00,0xff,0xc1,0x63,0x36,0x1c,0x08,0x00,0x00}, //index 11
    //usb
            {0x00,0x00,0xc0,0xe0,0xc0,0x08,0x0c,0xfe,0x00,0x00,0x00,0x07,0x0c,0x0c,0x6c,0xff}, //index 12
            {0xfe,0x0c,0x08,0x70,0xf0,0x70,0x00,0x00,0xff,0x63,0x03,0x03,0x01,0x00,0x00,0x00}, //index 13
    //no power
            {0x20,0xf8,0x0c,0x06,0x82,0xc3,0xe3,0xf3,0x07,0x1f,0x30,0x71,0x59,0xcd,0xc7,0xc3}, //index 14
            {0xb3,0xd3,0x63,0x32,0x1e,0x0c,0xf8,0xe0,0xd1,0xcd,0xc7,0xc3,0x61,0x30,0x1f,0x07}, //index 15
    //instment_setup
            {0x00,0x00,0x00,0x00,0xf8,0xfc,0xfe,0x8e,0x10,0x30,0x78,0xfc,0x3f,0x1f,0x0f,0x0f}, //index 16
            {0x06,0x02,0x38,0x03c,0x3c,0x9c,0xc0,0x00,0x0f,0x0e,0x0e,0x0e,0x0f,0x07,0x03,0x00}, //index 17
    //event_log
            {0x00,0x00,0x00,0xf8,0xef,0x6f,0x78,0x6f,0x00,0x00,0x00,0xff,0xff,0xdb,0xdb,0xdb}, //index 18
            {0x6f,0x78,0x6f,0xef,0xf8,0x00,0x00,0x00,0xdb,0xdb,0xdb,0xff,0xff,0x00,0x00,0x00}, //index 19
    //Restart
            {0xe0,0xf8,0x0c,0x06,0x02,0x03,0x03,0x03,0x07,0x1f,0x30,0x60,0x40,0xc0,0xc0,0xc0}, //index 20
            {0x01,0x02,0x03,0x01,0x04,0x14,0x50,0x40,0xc0,0x40,0x68,0x78,0x38,0x78,0x01,0x01}, //index 21
    //calibration
            {0xe0,0xf8,0x0c,0xc6,0x22,0x23,0x03,0xc3,0x07,0x1f,0x30,0x61,0x42,0xc2,0xc0,0xc3}, //index 22
            {0xa1,0xc2,0x03,0xe1,0x04,0x14,0x50,0x40,0xc0,0x43,0x68,0x7b,0x3a,0x7a,0x00,0x00}, //index 23
    //timer
            {0x00,0xc0,0xf0,0x18,0x08,0x0c,0x0c,0xef,0x00,0x07,0x0f,0x18,0x10,0x30,0x31,0x33}, //index 24
            {0xef,0x0c,0x0c,0x08,0x18,0xf2,0xe7,0x02,0x33,0x31,0x30,0x10,0x18,0x0f,0x07,0x00}, //index 25
    //signal
            {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf8,0xf8,0x00,0x00,0xff,0xff}, //index 26
            {0x00,0x00,0xf0,0xf0,0x00,0x00,0xff,0xff,0x00,0x00,0xff,0xff,0x00,0x00,0xff,0xff}, //index 27
    //settings
            {0x80,0xc0,0xfc,0xfc,0xfc,0x7c,0x3e,0x1f,0x01,0x03,0x3f,0x3f,0x3f,0x3e,0x7c,0xf8}, //index 28
            {0x1f,0x3e,0x7c,0xfc,0xfc,0xfc,0xc0,0x80,0xf8,0x7c,0x3e,0x3f,0x3f,0x3f,0x03,0x01}, //index 29
    //systemok
            {0xfc,0xfe,0xff,0xff,0xef,0x7e,0xfc,0xf8,0x01,0x03,0x07,0x0f,0x1f,0x3f,0x7f,0xfd}, //index 30
            {0xf8,0x7c,0xbe,0xdf,0xef,0xff,0xfe,0xfc,0xfe,0x7f,0x3f,0x1f,0x0f,0x07,0x03,0x01}, //index 31
    //systemok_2
            {0xe0,0xf8,0xfc,0xfe,0xfe,0x3f,0x7f,0xff,0x07,0x1f,0x3f,0x7f,0x7f,0xfe,0xfc,0xf8},
            {0x7f,0x3f,0x1f,0x8e,0xe6,0xfc,0xf8,0xe0,0xfc,0xfe,0xff,0x7f,0x7f,0x3f,0x1f,0x07},

    };
    memcpy(a, num_str[ascii_index], 8);
    memcpy(b, num_str[ascii_index] + 8, 8);
    memcpy(LOGO_ARR + ((x - 1) * 256) + ((y - 1) * 8), a, 8);
    memcpy(LOGO_ARR + ((x - 1) * 256) + ((y - 1) * 8) + 128, b, 8);

}

void draw_line(int x ,int y,unsigned char ascii_str[16]){

    int i;
    for(i = 0; i < strlen(ascii_str); i++){
        draw(x,y++,ascii_str[i]);
    }
}
void Display_Logo(int x ,int y, unsigned char logo_val)
{
    int i,j,ret;
    for(i=0;i<2;i++)
    {
        display_logos(x,y++,logo_val++);
    }
}

/* Set Entire Display OFF */
void display_off()
{
    sendCommand(0xA5);
}

/* Set Entire Display ON */
void display_on()
{
     sendCommand(0xAF);
}

/* Clear display */
void display_clear()
{
    sendData(clr_data);
}

void msdelay(int delay)
{
    int i,j;
    for(i=0;i<delay;i++)
        for(j=0;j<1000;j++);
}
